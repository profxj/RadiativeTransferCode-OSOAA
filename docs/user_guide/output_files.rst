Output Files
============

This guide describes all output files generated by OSOAA simulations and how to interpret them.

Output File Types
-----------------

OSOAA generates several types of output files:

1. **Radiance vs viewing angle** - Primary result file
2. **Radiance vs altitude/depth** - Vertical profile
3. **Advanced radiance output** - Detailed components
4. **Binary Fourier series** - For post-processing
5. **Log files** - Diagnostic information
6. **IOP files** - Inherent optical properties

Primary Output Files
--------------------

LUM_vsVZA.txt
~~~~~~~~~~~~~

**Radiance vs Viewing Zenith Angle**

This is the main output file specified by ``OSOAA.ResFile.vsVZA``.

File Format
^^^^^^^^^^^

::

    # OSOAA V2.0 - Radiance vs Viewing Zenith Angle
    # Wavelength: 550.0 nm
    # Solar zenith angle: 30.0 degrees
    # Relative azimuth: 90.0 degrees
    # Output level: -0.0 m (just below surface)
    # 
    # Columns:
    # 1: Viewing zenith angle (degrees)
    # 2: I - Total intensity (W/m²/sr/nm)
    # 3: Q - Stokes parameter Q (W/m²/sr/nm)
    # 4: U - Stokes parameter U (W/m²/sr/nm)
    # 5: V - Stokes parameter V (circular polarization, W/m²/sr/nm)
    # 6: DoLP - Degree of linear polarization (dimensionless, 0-1)
    # 7: AoLP - Angle of linear polarization (degrees, 0-180)
    #
    # VZA(deg)    I           Q           U           V         DoLP      AoLP
      0.00      0.01234    0.00012    0.00001   -0.00000    0.0097    2.32
     10.00      0.01289    0.00023    0.00002   -0.00000    0.0178    2.50
     20.00      0.01398    0.00045    0.00003   -0.00000    0.0322    1.91
     30.00      0.01572    0.00076    0.00005   -0.00000    0.0484    1.89
     ...

**Column Descriptions**:

1. **Viewing Zenith Angle (VZA)**: Direction of observation, 0° = nadir
2. **I**: Total radiance intensity (Stokes I parameter)
3. **Q**: Horizontal-vertical polarization difference
4. **U**: +45°/-45° polarization difference  
5. **V**: Circular polarization (usually negligible)
6. **DoLP**: Degree of Linear Polarization = :math:`\\sqrt{Q^2 + U^2}/I`
7. **AoLP**: Angle of Linear Polarization = :math:`0.5 \\arctan(U/Q)`

**Typical Values**:

* Water-leaving radiance: 0.001-0.1 W/m²/sr/nm
* Degree of polarization: 1-10%
* Negative Q typically indicates horizontal polarization dominance

Reading in Python
^^^^^^^^^^^^^^^^^

.. code-block:: python

    import numpy as np
    import matplotlib.pyplot as plt
    
    # Load data (skip header lines)
    data = np.loadtxt('LUM_vsVZA.txt', skiprows=15)
    
    vza = data[:, 0]
    I = data[:, 1]
    Q = data[:, 2]
    U = data[:, 3]
    V = data[:, 4]
    DoLP = data[:, 5]
    AoLP = data[:, 6]
    
    # Plot radiance
    plt.figure(figsize=(12, 5))
    
    plt.subplot(1, 2, 1)
    plt.plot(vza, I, 'b-', linewidth=2)
    plt.xlabel('Viewing Zenith Angle (degrees)')
    plt.ylabel('Radiance (W/m²/sr/nm)')
    plt.title('Water-Leaving Radiance')
    plt.grid(True, alpha=0.3)
    
    plt.subplot(1, 2, 2)
    plt.plot(vza, DoLP * 100, 'r-', linewidth=2)
    plt.xlabel('Viewing Zenith Angle (degrees)')
    plt.ylabel('Degree of Linear Polarization (%)')
    plt.title('Polarization')
    plt.grid(True, alpha=0.3)
    
    plt.tight_layout()
    plt.savefig('radiance_analysis.png', dpi=300)

LUM_vsZ.txt
~~~~~~~~~~~

**Radiance vs Altitude/Depth Profile**

Specified by ``OSOAA.ResFile.vsZ``. Shows how radiance varies vertically.

File Format
^^^^^^^^^^^

::

    # OSOAA V2.0 - Radiance vs Altitude/Depth
    # Wavelength: 550.0 nm
    # Viewing direction: Theta=30.0°, Phi=90.0°
    #
    # Positive Z = altitude in atmosphere (km)
    # Negative Z = depth in ocean (m)
    #
    # Columns:
    # 1: Z - Altitude/Depth
    # 2: I_up - Upwelling intensity
    # 3: I_down - Downwelling intensity
    # 4: Q_up, U_up, V_up - Upwelling Stokes parameters
    # 5: Q_down, U_down, V_down - Downwelling Stokes parameters
    #
    #   Z(km/m)    I_up      I_down     Q_up      Q_down    ...
      60.000    0.00001    0.15234   0.00000   0.00123
      50.000    0.00003    0.14892   0.00000   0.00145
       ...
       1.000    0.00234    0.12456   0.00023   0.01234
       0.100    0.01234    0.10234   0.00134   0.02456
       0.000    0.02456    0.08456   0.00234   0.03456  # Sea surface
      -0.000    0.01987    0.07234   0.00198   0.02987  # Just below surface
      -1.000    0.01456    0.05123   0.00145   0.02145
      -10.000   0.00456    0.01234   0.00045   0.00512
       ...
     -100.000   0.00012    0.00023   0.00001   0.00005

**Physical Interpretation**:

* **Upwelling**: Light traveling upward (toward sensor)
* **Downwelling**: Light traveling downward (toward depth)
* Discontinuity at Z=0: Fresnel reflection/refraction at interface
* Exponential decay in ocean: Governed by attenuation coefficient

Plotting Profile
^^^^^^^^^^^^^^^^

.. code-block:: python

    import numpy as np
    import matplotlib.pyplot as plt
    
    data = np.loadtxt('LUM_vsZ.txt', skiprows=20)
    
    z = data[:, 0]
    I_up = data[:, 1]
    I_down = data[:, 2]
    
    # Separate atmosphere and ocean
    atm_mask = z >= 0
    ocn_mask = z < 0
    
    plt.figure(figsize=(10, 8))
    
    # Upwelling
    plt.subplot(1, 2, 1)
    plt.plot(I_up[atm_mask], z[atm_mask], 'b-', label='Atmosphere', linewidth=2)
    plt.plot(I_up[ocn_mask], z[ocn_mask], 'g-', label='Ocean', linewidth=2)
    plt.xlabel('Upwelling Radiance (W/m²/sr/nm)')
    plt.ylabel('Altitude (km) / Depth (m)')
    plt.axhline(y=0, color='k', linestyle='--', alpha=0.5, label='Sea Surface')
    plt.legend()
    plt.grid(True, alpha=0.3)
    plt.title('Upwelling Radiance Profile')
    
    # Downwelling
    plt.subplot(1, 2, 2)
    plt.plot(I_down[atm_mask], z[atm_mask], 'b-', linewidth=2)
    plt.plot(I_down[ocn_mask], z[ocn_mask], 'g-', linewidth=2)
    plt.xlabel('Downwelling Radiance (W/m²/sr/nm)')
    plt.ylabel('Altitude (km) / Depth (m)')
    plt.axhline(y=0, color='k', linestyle='--', alpha=0.5)
    plt.grid(True, alpha=0.3)
    plt.title('Downwelling Radiance Profile')
    
    plt.tight_layout()
    plt.savefig('vertical_profile.png', dpi=300)

LUM_Advanced.txt
~~~~~~~~~~~~~~~~

**Advanced Radiance Components**

Specified by ``OSOAA.ResFile.Advanced``. Contains detailed breakdown of radiance components.

File Format
^^^^^^^^^^^

::

    # OSOAA V2.0 - Advanced Radiance Output
    # 
    # Components:
    # 1. Direct transmission (order 0)
    # 2. Single scattering (order 1)
    # 3. Multiple scattering (orders 2+)
    # 4. Surface reflection
    # 5. Atmospheric path radiance
    # 6. Water-leaving radiance
    # 7. Total radiance
    #
    # VZA   Direct    Single    Multiple  Surface   AtmPath   WaterLeav  Total
      0.0   0.00123   0.00234   0.00456   0.00089   0.00567   0.00123   0.01234
     10.0   0.00134   0.00256   0.00489   0.00091   0.00598   0.00129   0.01289
      ...

**Use Cases**:

* Understanding dominant scattering mechanisms
* Atmospheric correction algorithm development
* Validating successive orders convergence
* Sensitivity studies

Binary Output Files
-------------------

LUM_SF.bin
~~~~~~~~~~

**Fourier Series Binary File**

Specified by ``SOS.ResFile.Bin``. Contains radiance in Fourier series representation.

File Structure
^^^^^^^^^^^^^^

Binary format with Fourier coefficients:

::

    Record 1: Header information
      - Version number
      - Wavelength
      - Geometric parameters
      - Grid dimensions
    
    Record 2: Fourier coefficients (m=0)
      - Real and imaginary parts
      - For all angles and levels
    
    Record 3: Fourier coefficients (m=1)
      ...
    
    Record N: Fourier coefficients (m=M_max)

**Reading Binary File** (Fortran):

.. code-block:: fortran

    PROGRAM READ_LUM_SF
      IMPLICIT NONE
      
      INTEGER :: NZ, NANG, NFOURIER, M
      REAL*8 :: WAVELENGTH
      REAL*8, ALLOCATABLE :: RADIANCE(:,:,:)
      
      ! Open binary file
      OPEN(UNIT=10, FILE='LUM_SF.bin', FORM='UNFORMATTED', 
 &         STATUS='OLD')
      
      ! Read header
      READ(10) NZ, NANG, NFOURIER, WAVELENGTH
      
      ! Allocate arrays
      ALLOCATE(RADIANCE(NZ, NANG, 0:NFOURIER))
      
      ! Read Fourier coefficients
      DO M = 0, NFOURIER
        READ(10) RADIANCE(:,:,M)
      ENDDO
      
      CLOSE(10)
      
      ! Reconstruct full radiance field
      ! ...
      
    END PROGRAM

**Purpose**: 

* Efficient storage of full 3D radiance field
* Post-processing with custom viewing geometries
* Research applications requiring full angular distribution

Log Files
---------

AER_LOG.txt
~~~~~~~~~~~

**Aerosol Calculation Log**

Contains details of aerosol optical property calculations:

::

    ==========================================
    OSOAA Aerosol Calculations
    ==========================================
    
    Model: Mono-modal log-normal
    
    Size Distribution Parameters:
      Median radius: 0.150 µm
      Standard deviation: 0.600
      Distribution type: Log-normal
    
    Refractive Index:
      Real part: 1.450
      Imaginary part: 0.001
    
    Wavelength: 550.0 nm
    
    Computed Properties:
      Extinction coefficient: 0.123 km⁻¹
      Scattering coefficient: 0.122 km⁻¹
      Absorption coefficient: 0.001 km⁻¹
      Single scattering albedo: 0.992
      Asymmetry parameter: 0.654
      Aerosol optical thickness: 0.100
    
    Phase Function:
      Number of angles: 83
      Forward peak truncated: Yes
      Truncation threshold: 0.100
    
    Mie Calculations:
      Size parameter range: 0.010 - 50.000
      Number of size bins: 200
      Integration method: Gauss-Legendre
      Convergence: Achieved

HYD_LOG.txt
~~~~~~~~~~~

**Hydrosol Calculation Log**

Similar to aerosol log but for ocean particles:

::

    ==========================================
    OSOAA Hydrosol Calculations
    ==========================================
    
    Model: Chlorophyll-based bio-optical
    
    Input Parameters:
      Chlorophyll concentration: 0.100 mg/m³
      Profile type: Homogeneous
      Mineral concentration: Default
      CDOM absorption: Default
    
    Wavelength: 550.0 nm
    
    Phytoplankton:
      Absorption coefficient: 0.0123 m⁻¹
      Scattering coefficient: 0.0456 m⁻¹
      Backscattering ratio: 0.015
    
    Mineral-Like Particles:
      Scattering coefficient: 0.0089 m⁻¹
      Backscattering ratio: 0.018
    
    Total IOPs:
      Total absorption: 0.0567 m⁻¹
      Total scattering: 0.0545 m⁻¹
      Total attenuation: 0.1112 m⁻¹
      Optical depth (100m): 11.12

SEA_LOG.txt
~~~~~~~~~~~

**Surface Calculation Log**

Details of sea surface modeling:

::

    ==========================================
    OSOAA Surface Calculations
    ==========================================
    
    Surface Type: Rough (Cox & Munk)
    
    Parameters:
      Wind speed: 5.0 m/s
      Refractive index: 1.334
      
    Wave Slope Statistics:
      Sigma_crosswind: 0.0286
      Sigma_upwind: 0.0158
      Mean square slope: 0.000953
    
    Reflection/Transmission Matrices:
      Angular resolution: 1024 azimuth angles
      Geometric configurations computed: 2456
      Wave facet integration: Complete
      
    Fresnel Coefficients:
      Computed for 50 incident angles
      Computed for 50 viewing angles
      
    Computation Time:
      Reflection matrices: 15.3 minutes
      Transmission matrices: 12.7 minutes
      Total: 28.0 minutes

SOS_LOG.txt
~~~~~~~~~~~

**Radiative Transfer Core Log**

Successive orders iteration details:

::

    ==========================================
    OSOAA Successive Orders Calculation
    ==========================================
    
    Configuration:
      Maximum orders: 100
      Convergence threshold: 0.001
      
    Iteration Progress:
    
    Order  1: Relative change = 1.000000 (initial)
           CPU time = 2.34 seconds
    
    Order  2: Relative change = 0.234567
           CPU time = 2.56 seconds
    
    Order  3: Relative change = 0.056789
           CPU time = 2.61 seconds
    
    Order  4: Relative change = 0.012345
           CPU time = 2.59 seconds
    
    Order  5: Relative change = 0.002345
           CPU time = 2.58 seconds
    
    Order  6: Relative change = 0.000456 ** CONVERGED **
           CPU time = 2.57 seconds
    
    Convergence Summary:
      Total orders computed: 6
      Convergence achieved: YES
      Total CPU time: 15.25 seconds
      
    Fourier Decomposition:
      Maximum Fourier order: 12
      Fourier convergence threshold: 0.0002
      Fourier terms used: 8

IOP Output Files
----------------

AER_IOP.txt
~~~~~~~~~~~

**Aerosol Inherent Optical Properties**

Specified by ``AER.ResFile.IOP``:

::

    # Aerosol Inherent Optical Properties
    # Wavelength: 550.0 nm
    #
    # Altitude(km)  Ext_coef(km⁻¹)  Scat_coef  Abs_coef  SSA    g
      60.00         0.00001         0.00001    0.00000  1.000  0.650
      50.00         0.00003         0.00003    0.00000  1.000  0.650
       ...
       2.00         0.10234         0.10134    0.00100  0.990  0.654
       1.00         0.12456         0.12334    0.00122  0.990  0.654
       0.00         0.15678         0.15534    0.00144  0.991  0.654

Where:

* Ext_coef: Extinction coefficient
* Scat_coef: Scattering coefficient
* Abs_coef: Absorption coefficient
* SSA: Single scattering albedo
* g: Asymmetry parameter

HYD_IOP.txt
~~~~~~~~~~~

**Hydrosol Inherent Optical Properties**

Specified by ``HYD.ResFile.IOP``:

::

    # Hydrosol Inherent Optical Properties
    # Wavelength: 550.0 nm
    #
    # Depth(m)  Abs_coef(m⁻¹)  Scat_coef  Bscat_coef  bbp    Chl(mg/m³)
      -0.0      0.0567        0.0545     0.00082    0.015    0.100
      -1.0      0.0567        0.0545     0.00082    0.015    0.100
     -10.0      0.0567        0.0545     0.00082    0.015    0.100
       ...
    -100.0      0.0567        0.0545     0.00082    0.015    0.100

Where:

* Abs_coef: Total absorption (phyto + CDOM + minerals)
* Scat_coef: Total scattering
* Bscat_coef: Backscattering coefficient
* bbp: Backscattering ratio
* Chl: Chlorophyll concentration at this depth

Data Validation
---------------

Sanity Checks
~~~~~~~~~~~~~

Always verify:

1. **Physical range**: Radiance values should be positive and reasonable
2. **Spectral behavior**: Blue > green > red for clear water
3. **Angular dependence**: Smooth variation with angle
4. **Polarization**: 0 ≤ DoLP ≤ 1
5. **Energy conservation**: Total flux checks out

Common Issues
~~~~~~~~~~~~~

**Negative radiances**:

* Check input parameters
* Review convergence
* Examine log files for errors

**Unrealistic magnitudes**:

* Verify units
* Check solar zenith angle
* Review optical properties

**Discontinuities**:

* May indicate insufficient angular resolution
* Check for numerical artifacts
* Review surface calculations

Post-Processing Tools
---------------------

Python Analysis Suite
~~~~~~~~~~~~~~~~~~~~~

Create reusable analysis functions:

.. code-block:: python

    import numpy as np
    import matplotlib.pyplot as plt
    
    class OSOAAResults:
        """Class for analyzing OSOAA output files"""
        
        def __init__(self, filename):
            self.data = np.loadtxt(filename, skiprows=15)
            self.vza = self.data[:, 0]
            self.I = self.data[:, 1]
            self.Q = self.data[:, 2]
            self.U = self.data[:, 3]
            self.DoLP = self.data[:, 5]
            
        def plot_radiance(self):
            """Plot radiance vs angle"""
            plt.figure()
            plt.plot(self.vza, self.I)
            plt.xlabel('VZA (degrees)')
            plt.ylabel('Radiance (W/m²/sr/nm)')
            plt.grid(True)
            
        def compute_reflectance(self, E0=1.0):
            """Compute water-leaving reflectance"""
            return np.pi * self.I / E0
            
        def find_nadir(self):
            """Get nadir radiance"""
            idx = np.argmin(np.abs(self.vza))
            return self.I[idx]

Next Steps
----------

* :doc:`../examples/basic_simulation` - Analysis examples
* :doc:`../reference/file_formats` - Detailed format specifications
* :doc:`../technical/algorithms` - Understanding the calculations
